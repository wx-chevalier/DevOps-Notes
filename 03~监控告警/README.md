# 监控告警

本部分主要关注服务端系统的监控与告警。前端相关的监控体系建设请参考 [Web Series](https://github.com/wx-chevalier/Web-Notes)。

![监控与告警体系思维脑图](https://s1.ax1x.com/2020/08/08/aIFbSf.png)

## 监控系统的目标与作用

监控系统在运维中扮演着至关重要的角色。无论你是监控系统的开发者还是使用者，都需要明确其目标和作用：

1. 实时数据采集：涵盖硬件、操作系统、中间件、应用程序等各个层面。
2. 实时状态反馈：通过多维度统计和可视化，实时展示监控对象的状态。
3. 预知故障和告警：提前识别故障风险，及时发出告警。
4. 辅助故障定位：提供故障发生时的各项指标数据，协助分析和定位。
5. 支持性能调优：为性能优化提供数据支持，如慢 SQL、接口响应时间等。
6. 辅助容量规划：为服务器、中间件及应用集群的容量规划提供数据支撑。
7. 支持自动化运维：为智能运维（如自动扩容、服务降级）提供数据基础。

## 有效使用监控系统的关键点

拥有优秀的监控系统只是第一步，更重要的是如何有效使用它。成熟的研发团队通常会制定监控规范，统一使用方法：

1. 深入了解监控对象：掌握监控对象的工作原理，如监控 JVM 需了解其堆内存结构和垃圾回收机制。
2. 确定关键监控指标：选择合适的指标来描述监控对象的状态，如接口监控可包括请求量、响应时间、超时量、异常量等。
3. 设置合理的告警阈值和等级：定义适当的告警触发条件和相应的故障等级，避免无效告警。
4. 建立完善的故障处理流程：制定清晰的故障响应流程和 on-call 机制，确保及时处理告警。

## 黑盒监控与白盒监控

### 黑盒监控

传统 IT 运维常用 Nagios 等工具进行黑盒监控，提供系统停机、服务器/服务停机、CPU 高消耗等基本信号。这种监控方式有助于识别问题症状，但难以揭示根本原因。

### 白盒监控

白盒监控深入系统内部，帮助确定问题根源，并可通过趋势分析预防潜在问题。它包括：

1. 日志记录
2. 性能指标
3. 分布式跟踪

当正确使用这些工具时，可能就不再需要黑盒监控，但保留黑盒监控作为补充仍然是明智的选择。

## 监控数据采集方式

1. 日志：重要的监控数据来源，可使用 Rsyslog、Logstash、Filebeat、Flume 等工具采集。
2. JMX：适用于 Java 服务，多数监控系统集成了 JMX 采集插件。
3. REST API：如 Hadoop、ElasticSearch 提供的监控数据接口。
4. OpenMetrics：源于 Prometheus，可能成为未来监控的行业标准。
5. 命令行：一些服务提供本地命令输出监控指标。
6. 主动上报：服务直接将监控指标推送到监控系统。
7. 埋点：侵入式但灵活的监控数据采集方式，可提供详细的业务指标。
8. 其他方式：如 Zookeeper 的四字命令，MySQL 的 show status 命令等。

- [我经历过的监控系统演进史](https://mp.weixin.qq.com/s/uk0qKcmlHwlCeC_zJhWgow)
